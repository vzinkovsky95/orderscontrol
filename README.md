# orderscontrol

Система учета заказов - `orderscontrol`.

Этот проект представляет собой систему, состоящую из нескольких компонентов, которые автоматизируют процесс извлечения данных о заказах из API, их хранения в базе данных MySQL, скачивания соответствующих квитанций и поддержания актуальной информации о клиентах.

Основные компоненты проэекта

- **`getorders.py`**: Этот скрипт отвечает за извлечение данных о заказах из API. Он выполняет HTTP-запросы к API, используя аутентификацию на основе токенов, и сохраняет полученные данные в файл JSON (`data.json`). Затем скрипт загружает (или обновляет) данные в таблицу `orderstable` в базе данных MySQL. Скрипт поддерживает использование различных тел запросов (request bodies) для получения разных типов данных из API.  В случае, если запись о заказе уже есть в базе, она будет обновлена при наличии изменений.

- **`getdocs.py`**: Этот скрипт отвечает за скачивание квитанций для заказов, хранящихся в таблице `orderstable`. Он скачивает квитанции по URL-адресам, указанным в таблице, сохраняет их в файловой системе в каталогах, организованных по коду клиента, вычисляет MD5-хеш файлов и записывает информацию о скачанных квитанциях в таблицу `orderdocstable` в базе данных MySQL. Скрипт имеет механизм повторных попыток для обработки временных сбоев при скачивании.

- **SQL Триггеры (`sqltriggerforcustumers`):** Эти триггеры, установленные на таблицу `orderstable`, автоматически обновляют таблицу `customers` при добавлении, обновлении или удалении записей в таблице `orderstable`. Триггеры поддерживают актуальную информацию о клиентах, такую как общее количество заказов, количество подтвержденных заказов, даты последних заказов и агрегированные суммы платежей. Они также автоматически добавляют новых клиентов в таблицу `customers`, когда они впервые появляются в таблице `orderstable`.
